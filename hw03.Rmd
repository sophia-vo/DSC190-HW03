---
title: "Statistical Analysis of CMV DNA Data"
output: pdf_document
date: "2024-11-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
hcmv_data <- read.table("hcmv.txt", header = TRUE, sep="")
hcmv <- read.table("hcmv.txt", header = TRUE)
sequence_length <- 229354
num_palindromes <- 296
interval_size <- 1000
```

## Contribution

Student 1 was responsible for Analysis Questions 3, 4, and 5. Student 2 was responsible for Analysis Questions 1, 2 and the Advanced Analysis. Both Student 1 and 2 were responsible for the Introduction and Discussion.

# 1. Introduction

Cytomegalovirus (CMV) is a complex DNA virus with a genome comprising 229,354 base pairs. DNA sequences contain many patterns, and some of these patterns may flag important sites on the DNA, such as the origin of replication. The origin of replication is special patterns in the virus’ DNA that contains instructions for its reproduction. To develop strategies for combating the virus, scientists want study the way in which the virus replicates. Our analysis uses data from the DNA sequence of CMV that was published in 1990 (Chee etal.) that is 229,354 letters long. Leung et al. (1991) implemented search algorithms to screen the sequence for many types of patterns. Altogether, 296 palindromes were found that were at least 10 letters long, with the longest being 18 letters. Palindromes are DNA sequences that read the same forwards and backwards, often associated with key genetic elements such as replication origins, regulatory regions, and DNA binding sites. By identifying and studying these palindromic patterns, researchers can gain a better understanding of how the virus replicates and interacts with the host cell.

The primary goal of this statistical analysis is to assess how the distribution of palindromes deviates from a uniform scatter across the DNA sequence and if any clusters are due to random chance. We applied statistical methods to compare the distribution of actual palindromic sequences in the CMV genome against what would be expected from random distribution models. We used a combination of Kolmogorov-Smirnov tests, Chi-square goodness-of-fit tests, and Poisson distribution models to analyze spacing, interval counts, and locations of palindromic sequences, testing whether observed clustering could be attributed to random chance or if it might indicate an underlying biological structure.

We found that palindromic sequences are uniformly distributed across the genome, with no significant variability in the number of palindromes observed in different regions. Analysis of palindrome counts revealed that shorter intervals had greater variability than larger intervals and that certain region lengths (500, 20000, 50000) showed clustering, suggesting that these areas are less likely to occur by random chance. Further exploration of these clusters showed statistically significant clustering at region length 500.

The findings suggest that while some small-scale clustering is evident, particularly in the 500-base pair regions, the overall distribution of palindromes does not significantly deviate from random scatter on a larger scale. This could imply that palindromes are dispersed across the genome in a manner consistent with random chance, but local variations might still hold biological significance.

The report is structured as follows: Section 1 introduces this study's objectives, background, and key questions, Section 2 analyzes the randomness of palindrome distribution, spatial patterns of palindromic sequences, palindrome counts in different genome regions, and the presence of significant clusters. Section 3 explores the robustness of statistical assumptions in studying palindrome distribution across the CMV DNA sequence. Section 4 summarizes the findings and discusses possible methods for searching for the origin of replication.

# 2. Analysis

## 2.1 Random Scatter

### 2.1.1 Methods

To determine if the observed palindromic sites in CMV DNA are randomly scattered or exhibit clustering, which could indicate biological significance, we simulate what a random scatter of palindromic sites along a DNA sequence of 229,354 bases would look like and use statistical comparisons to determine if the observed distribution is significantly different from what we would expect under random conditions.

Using a pseudo-random number generator, we simulate 296 palindrome locations randomly distributed along a DNA sequence of length 229,354. This process is repeated to obtain a robust sample of random distributions. To simulate random scattering, we use a uniform distribution to place 296 palindrome sites along the DNA sequence. Since we’re assessing whether the real data deviates from a random scatter, we assume each location is equally likely (to have an equal probability of containing a palindrome under the null hypothesis of randomness), meaning each position on the DNA sequence has a uniform probability of selection, justifying the use of a uniform distribution.

A uniform distribution for our purposes is defined by the probability \( P(X = x) = \frac{1}{b - a} \) for all \( x \) in the interval \([a, b]\), where \( a = 1 \) and \( b = 229354 \), the sequence length. Each randomly generated site should be uniformly distributed over the DNA sequence, producing an expected random scatter.

We will visually compare the distribution of actual palindrome locations, palindrome counts per intervals of 1000, and location spacing, against the simulated distributions using histograms to see if the observed results match the expectation under a random scattering model and identify potential clustering in the actual data. We use summary statistics, including mean and variance, to quantitatively assess whether the observed distribution deviates significantly from the simulated random distributions.

To test whether the observed distribution matches a random scatter, we use the Kolmogorov-Smirnov test, comparing the distribution of actual palindrome locations to the randomly simulated distributions. The K-S test quantifies the maximum distance between the cumulative distributions of two samples, returning a p-value that can help us determine whether to reject the null hypothesis (i.e., that the distribution of palindrome locations is random). A small p-value (e.g., < 0.05) would suggest a significant deviation from a random distribution.

### 2.1.2 Analysis

In the simulations, random palindromic sites are scattered across the DNA sequence, with uniform distribution expected under the null hypothesis. The histograms below visualize the distribution of randomly simulated palindromic sites, which we use as a reference to compare the actual distribution of observed palindrome locations.

```{r, echo=FALSE, fig.height = 3.5}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

# Histogram of Real Data Palindromic Site Location
hist(hcmv$location, breaks = 15, probability = TRUE, col = rgb(1, 0, 0, 0.25),
     main = "Palindromic Sites of Real Data",
     xlab = "Location in DNA Sequence")
lines(density(hcmv$location, adjust = 1), col = 2)

# Simulation of Uniform Distribution of Palindromic Sites
set.seed(123)
simulated_palindromes <- runif(num_palindromes, min = 1, max = sequence_length)

# Histogram of Simulated Data Palindromic Site Location
hist(simulated_palindromes, breaks = 15, probability = TRUE, col = rgb(0,0,1,0.25), main = "Palindromic Sites of Simulated Data",
     xlab = "Location in DNA Sequence")
lines(density(simulated_palindromes, adjust = 1), col = 4)
par(mfrow = c(1, 1), cex = 1)
```
```{r, echo=FALSE, fig.height = 4, fig.width = 6, fig.align='center'}
par(mfrow = c(1, 1), cex = 0.8)
# Layered Histogram for Graphical Comparison
hist(hcmv$location, breaks = 25, probability = TRUE, col = rgb(1, 0, 0, 0.25),
     main = "Palindromic Sites of Real & Simulated Data",
     xlab = "Location in DNA Sequence")
lines(density(hcmv$location, adjust = 1), col = 2)
hist(simulated_palindromes, breaks = 25, probability = TRUE, col = rgb(0,0,1,0.25), add = TRUE)
lines(density(simulated_palindromes, adjust = 1), col = 4)
legend("topright", legend = c("Real", "Simulated"), 
       fill = c(rgb(1, 0, 0, 0.25), rgb(0,0,1,0.25)), border = NA,
       cex = 0.8)   # Scale down legend text
par(mfrow = c(1, 1), cex = 1)
```
Additional histograms of repeated random scatters can be found in the [Appendix](#appendix).

The histograms for spacing and counts should look similar if the real data follows a random scatter. A notable deviation in real data (e.g., many more intervals with high or low counts than expected in the simulations) would suggest clustering. The spacing and counts histograms can be fund below.

```{r, echo=FALSE, fig.height=4}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)
# Grouping palindrome location in bins of 1000
tab <- table(cut(hcmv$location, 
                     breaks = seq(from = 1, to = 230000, by = 1000), 
                     include.lowest = TRUE))
counts <- as.vector(tab)

sim_tab <- table(cut(simulated_palindromes, 
                 breaks = seq(from = 1, to = 230000, by = 1000), 
                 include.lowest = TRUE))
sim_counts <- as.vector(sim_tab)

# Histogram of Counts in Each Interval
hist(sim_counts, breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), probability = TRUE, col = rgb(0, 0, 1, 0.25), main = "Real & Simulated Interval Counts", xlab = "number of points inside an interval", ylim = c(0,0.5))
lines(density(sim_counts, adjust = 2), col = rgb(0,0,1,0.5))

hist(counts, breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), probability = TRUE, col = rgb(1, 0, 0, 0.25), add = TRUE)
lines(density(counts, adjust = 2), col = rgb(1,0,0,0.5))

legend("topright", legend = c("Real", "Simulated"), fill = c(rgb(1, 0, 0, 0.25), rgb(0,0,1,0.25)), border = NA)

# Calculate spacing for each simulation

# Real data
real_spacing <- diff(hcmv$location)
real_counts <- table(cut(hcmv$location, breaks = seq(0, sequence_length, by = interval_size), include.lowest = TRUE))

# Simulated data
simulated_spacings <- diff(sort(simulated_palindromes))
simulated_counts <- table(cut(simulated_palindromes, breaks = seq(0, sequence_length, by = interval_size), include.lowest = TRUE))

# Spacing histograms
hist(real_spacing, breaks = 10, col = rgb(1, 0,0,0.25), probability = TRUE, main = "Real & Simulated Data Spacing", xlab = "Spacing")
hist(unlist(simulated_spacings), breaks = 10, probability = TRUE, col = rgb(0, 0, 1, 0.25), add = TRUE)
lines(density(real_spacing, adjust = 1), col = rgb(1,0,0,0.5))
lines(density(unlist(simulated_spacings), adjust = 1), col = rgb(0,0,1,0.5))
legend("topright", legend = c("Real Data", "Simulated Data"),
       fill = c(rgb(1, 0, 0, 0.25), rgb(0, 0, 1, 0.25)), border = NA)
par(mfrow = c(1, 1), cex = 1)
```

We calculate the mean and variance of spacings between palindromes in both the real and simulated data.
If the real data has significantly lower spacing variance, this could indicate clustering (i.e., the palindromic sites are closer together than we would expect from a random scatter).

```{r, echo=FALSE}
# Load necessary libraries
library(knitr)
library(kableExtra)

# Data for real and simulated summaries
quantitative_summary <- data.frame(
  Statistic = c("Mean Spacing", "Variance of Spacing", "Std Dev of Spacing",
                "Mean Counts", "Variance of Counts", "Std Dev of Counts"),
  Real = c(775.512, 693560.5, 832.803, 12.727, 14.589, 3.820),
  Simulated = c(772.527, 477052.8, 690.690, 12.955, 10.807, 3.287)
)

# Create and format the table
kable(quantitative_summary, caption = "Quantitative Comparison of Real vs Simulated Data") %>%
  kable_styling(latex_options = c("striped", "hold_position"), full_width = FALSE)
```

The Kolmogorov-Smirnov (KS) tests were conducted to compare the distributions of real data with simulated data in three different cases: spacing, counts, and palindrome locations. Here are the results for each:

**Spacing (Real vs. Simulated)**

Test Statistic (D): 0.081356

p-value: 0.283

The p-value of 0.283 is greater than the common significance level of 0.05, suggesting that there is no significant difference between the distributions of real and simulated spacing. Thus, we do not have sufficient evidence to reject the null hypothesis, and the real and simulated spacing distributions appear similar.

**Counts (Real vs. Simulated)**

Test Statistic (D): 0.22727

p-value: 0.4767

The p-value of 0.4767 is also greater than 0.05, indicating no significant difference between the distributions of real and simulated counts. The real and simulated counts distributions are similar. 

**Palindrome Locations (Real vs. Simulated)**

Test Statistic (D): 0.040541

p-value: 0.9681

The very high p-value of 0.9681 suggests that there is no significant difference between the distributions of palindrome locations in the real and simulated data. The locations of palindromes in the real data closely resemble those in the simulated data.

### 2.1.3 Conclusion

The comparison between the actual distribution of palindromic locations and the randomly simulated distributions does not show any significant deviations from a Uniform Distribution. The histogram of actual palindrome locations does not show significant areas with higher concentration of palindromic sequences than what is typically seen in the random simulations, suggesting the lack of potential clustering. The overlaid histograms visually demonstrate that the distribution of palindromic sites in both the real and simulated data are quite similar. This similarity extends to the interval counts and the spacing between sites, where the shapes of the distributions in both datasets appear comparable. These results suggest that the real data does not diverge significantly from what would be expected under a random scattering model, as the real and simulated data align closely in their overall distribution patterns.

The analysis of palindrome distributions in real and simulated DNA sequence data reveals minimal differences; palindromic sites in the real data do not significantly deviate from a random scatter. The quantitative summary shows that the mean spacing between palindromes is similar for both real (775.5) and simulated (772.5) data, though the variance in spacing for the real data (693,560.5) is somewhat higher than in the simulated data (477,052.8). While this variance difference could suggest mild clustering tendencies, the consistency in mean values implies that this clustering is not substantial. Similar values in mean and variance of palindrome counts per interval further support a uniform distribution assumption.

Kolmogorov-Smirnov tests comparing spacing, interval counts, and palindrome locations between real and simulated data all resulted in high p-values (p > 0.05); we have no significant evidence to reject the null hypothesis in any of these cases, confirming that the real and simulated distributions align closely. 
These findings suggest that the distribution of palindromic sites in the real data closely resembles a random scatter, with little evidence of significant clustering or structured patterns.

## 2.2 Locations and Spacings

### 2.2.1 Methods

To examine the spatial distribution of palindromic sequences we will analyze the spacings between consecutive palindromic sites, as well as sums of consecutive pairs and triplets of palindromic sites to assess if clustering is more prevalent than expected under random distribution.

The simulated random distribution in Question 1 will be used to generate spacings, pair sums, and triplet sums for comparison. Histograms and box plots will be used to display the distributions of spacings, pair sums, and triplet sums for comparison to their theoretical distributions under random scatter. A Kolmogorov-Smirnov (KS) test is used to test if the observed distributions significantly deviate from the expected random distributions.

### 2.2.2 Analysis

The graphs for the spacing between consecutive palindromes are as follows:

```{r, echo=FALSE, fig.height=3.5}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

real_spacings <- real_spacing

# Histogram of spacing for real and simulated data
hist(real_spacings, breaks = 15, probability = TRUE, col = rgb(1, 0, 0, 0.25),
     main = "Consecutive Palindromic Sites",
     xlab = "Spacing (Bases)")
lines(density(real_spacings), col = "red", lwd = 2)

hist(simulated_spacings, breaks = 10, probability = TRUE, col = rgb(0, 0, 1, 0.25), add = TRUE)
lines(density(simulated_spacings), col = "blue", lwd = 2)

legend("topright", legend = c("Real Data", "Simulated Data"), fill = c(rgb(1, 0, 0, 0.25), rgb(0, 0, 1, 0.25)))

boxplot(real_spacings, simulated_spacings,
        names = c("Real Data", "Simulated Data"),
        col = c("red", "blue"),
        main = "Boxplot of Spacing",
        ylab = "Spacing (Bases)")
par(mfrow = c(1, 1), cex = 1)
```

The distributions of the sums of palindrome pairs are as follows:

```{r, echo=FALSE, fig.height=3.5}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

# Calculate pair sums
real_pair_sums <- real_spacings[-length(real_spacings)] + real_spacings[-1]
simulated_pair_sums <- simulated_spacings[-length(simulated_spacings)] + simulated_spacings[-1]

# Histogram of pair sums for real and simulated data
hist(real_pair_sums, breaks = 15, probability = TRUE, col = rgb(1, 0, 0, 0.25),
     main = "Sums of Consecutive Pairs",
     xlab = "Pair Sums (Bases)", ylim = c(0, max(density(simulated_pair_sums)$y)+0.00009))
lines(density(real_pair_sums), col = "red", lwd = 2)

hist(simulated_pair_sums, breaks = 15, probability = TRUE, col = rgb(0, 0, 1, 0.25), add = TRUE)
lines(density(simulated_pair_sums), col = "blue", lwd = 2)

legend("topright", legend = c("Real Data", "Simulated Data"), fill = c(rgb(1, 0, 0, 0.25), rgb(0, 0, 1, 0.25)))

boxplot(real_pair_sums, simulated_pair_sums,
        names = c("Real Data", "Simulated Data"),
        col = c("red", "blue"),
        main = "Boxplot of Pair Sums",
        ylab = "Pair Sums (Bases)")
par(mfrow = c(1, 1), cex = 1)
```

The distributions of the sums of palindrome triplets are as follows:

```{r, echo=FALSE, warning=FALSE, fig.height=3.5}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

# Calculate triplet sums
real_triplet_sums <- real_spacings[-(length(real_spacings)-1)] +
  real_spacings[-c(1, length(real_spacings))] +
  real_spacings[-c(1, 2)]

simulated_triplet_sums <- simulated_spacings[-(length(simulated_spacings)-1)] +
  simulated_spacings[-c(1, length(simulated_spacings))] +
  simulated_spacings[-c(1, 2)]

# Histogram of triplet sums for real and simulated data
hist(simulated_triplet_sums, breaks = 15, probability = TRUE, col = rgb(0, 0, 1, 0.25), main = "Sums of Consecutive Triplets",
     xlab = "Triplet Sums (Bases)")
hist(real_triplet_sums, breaks = 15, probability = TRUE, col = rgb(1, 0, 0, 0.25), add = TRUE)
lines(density(real_triplet_sums), col = "red", lwd = 2)
lines(density(simulated_triplet_sums), col = "blue", lwd = 2)

legend("topright", legend = c("Real Data", "Simulated Data"), fill = c(rgb(1, 0, 0, 0.25), rgb(0, 0, 1, 0.25)))

boxplot(real_triplet_sums, simulated_triplet_sums,
        names = c("Real Data", "Simulated Data"),
        col = c("red", "blue"),
        main = "Boxplot of Triplet Sums",
        ylab = "Triplet Sums (Bases)")
par(mfrow = c(1, 1), cex = 1)

```

The Kolmogorov-Smirnov test for spacing yielded a p-value of 0.283, indicating that the observed distribution is consistent with the expected exponential distribution for random scatter. The KS test for pair sums yielded a p-value of 0.09365, the test for triplet sums returned a p-value of 0.1675. These p-values indicate that the observed distributions of pair and triplet sums are consistent with the uniform distribution expected under random scattering.

The Cumulative distribution plot for spacings can be seen below:

```{r, echo=FALSE, fig.height = 4, fig.width=5, fig.align='center'}
par(mfrow = c(1, 1), cex = 0.8)
# Cumulative distribution plot for spacings
plot(ecdf(real_spacings), col = "red", main = "Cumulative Distribution of Spacings",
     xlab = "Spacing (Bases)", ylab = "Cumulative Probability", pch = 20, lwd = 1)
lines(ecdf(simulated_spacings), col = "blue", pch = 20, lwd = 1)
legend("bottomright", legend = c("Real Data", "Simulated Data"), col = c("red", "blue"), lwd = 2)
par(mfrow = c(1, 1), cex = 1)
```

### 2.2.3 Conclusion

The distribution of spacings between palindromic sequences in the actual data shows similar variance to the simulated random data, suggesting that  palindromes may regularly spaced, with no significant regions of clustering. The histograms of sums of consecutive pairs and triplets of palindromic locations do not indicate specific regions of higher concentration. The box plots similarly have close medians and quartiles.

The K-S test on spacings indicates whether the distribution of observed spacings significantly deviates from a uniform scatter. A low p-value would imply non-random clustering, while a high p-value would suggest the distribution could be random. All the tests resulted in a p-value exceeding 0.05, suggesting that the observed distributions align with random scatter expectations; we can conclude that the palindromic sequences are randomly scattered along the sequence.

The spacings of palindromes in the data seem to have no significant deviations from what is expected of a uniform random scatter, suggesting a lack of significant clusters or unusual spacings in palindrome locations.

## 2.3 Palindrome Counts

### 2.3.1 Methods

To examine palindrome counts in different regions of DNA, we split the DNA sequence into equal-length, non-overlapping regions, counted the palindromic sequences in each, and compared these counts to those expected from a uniform random scatter. To visualize the results, we graphed histograms to visualize the distribution of palindrome counts across regions. We then used Chi-Square Goodness of Fit Tests to compare observed palindrome counts to expected counts, testing the hypothesis of a uniform random distribution of palindromic sequences across regions.

### 2.3.2 Analysis

The histograms and Chi-Square Test results are shown below.

```{r, echo=FALSE, fig.width=7, fig.height=3}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

region_lengths <- c(500, 1000, 5000, 10000, 20000, 50000)

#Chi-Square Test Results Table
chi_square_results <- data.frame(
  `Region Length` = integer(),
  `Chi-Square Statistic` = numeric(),
  `p-value` = numeric(),
  `Interpretation` = character()
)

# Function for analyzing palindromes
analyze_palindromes <- function(region_length) {
  # Total number of non-overlapping regions
  num_regions <- ceiling(sequence_length / region_length)
  
  # Define region breaks and count palindromes in each interval
  region_breaks <- seq(1, sequence_length, by = region_length)
  
  # Count occurrences in each interval
  region_indices <- cut(hcmv_data$location, breaks = region_breaks, include.lowest = TRUE, labels = FALSE)
  counts <- table(region_indices)
  
  # Initialize counts vector with zeros for all regions
  counts_vector <- rep(0, num_regions)
  
  # Fill counts_vector based on the numeric indices
  counts_vector[as.numeric(names(counts))] <- as.vector(counts)
  
  # Expected count per region under uniform distribution
  expected_count <- length(hcmv_data$location) / num_regions
  
  hist(counts_vector, 
       breaks = seq(-0.5, max(counts_vector) + 0.5, by = 1),
       col = "blue", 
       border = "black", 
       main = paste("Count Distribution for Region  =", region_length),
       xlab = "Number of Palindromes per Region", 
       ylab = "Frequency")
  abline(v = expected_count, col = "red", lty = "dashed")
  
  # Classify regions by number of palindromes
  classified_counts <- table(cut(counts_vector, breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, Inf), include.lowest = TRUE))

  # Chi-square test comparing observed to expected uniform distribution
  chi_square_test <- chisq.test(counts_vector, p = rep(1 / num_regions, num_regions), simulate.p.value = TRUE)
  
  interpretation <- ifelse(chi_square_test$p.value < 0.001, 
                           "Significant",
                           "Not Significant")

  chi_square_results <<- rbind(
    chi_square_results,
    data.frame(
      `Region Length` = region_length,
      `Chi-Square Statistic` = chi_square_test$statistic,
      `p-value` = chi_square_test$p.value,
      `Interpretation` = interpretation
    )
  )
  
  return(counts_vector)
}

# Analyze for different region lengths
region_lengths <- c(500, 1000, 5000, 10000, 20000, 50000)
results <- lapply(region_lengths, analyze_palindromes)

kable(chi_square_results, caption = "Chi-Square Test Results") %>%
  kable_styling(latex_options = c("striped", "hold_position"), full_width = FALSE)
```


### 2.3.3 Conclusion

The histograms of palindrome counts revealed that the smaller the region length, the more right skewed the count histogram was, which indicates that shorter regions have a higher frequency of intervals with low or zero palindrome counts, while a few regions have unusually high counts. This is consistent with the idea that smaller regions are more susceptible to variability in palindrome counts. Using a cut-off value of 0.001, the chi-square tests yield significant p-values for very small and very high region lengths, but insignificant p-values for middle region lengths. The significant result at region length 500 suggests that palindromic sequences are clustered in certain small regions rather than being uniformly scattered across the DNA. The non-significant results at the intermediate scales (region lengths 1,000, 5,000, and 10,000) imply that, when viewed at these sizes, the distribution of palindromic sequences appears more uniform. At these lengths, local clusters of palindromic sequences are likely averaged out, resulting in counts that are more consistent with a uniform random distribution. The significant results at region lengths 20,000 and 50,000 indicate that there are large-scale patterns in the distribution of palindromic sequences across broad DNA segments.

## 2.4 The Biggest Cluster

### 2.4.1 Methods

We now want to investigate whether the interval with the highest number of palindromic sequences in a DNA sequence could suggest a potential origin of replication. To do this, we determined if a high-count palindrome cluster deviates significantly from a random scatter and whether such clusters align with features characteristic of origins of replication. Based on prior analysis, region lengths were selected to avoid both overly large and overly small intervals. Small intervals risk splitting clusters across adjacent regions, while large intervals may obscure tight clusters. For each interval, the number of palindromic sequences was counted, yielding a distribution of palindrome counts across intervals and the interval with the highest count of palindromic sequences was identified. Finally, Chi-square goodness of fit tests were applied to determine if the palindrome count in the highest-count interval deviates significantly from expected counts under a random distribution. Histograms were generated to visualize palindrome counts across intervals.

### 2.4.2 Analysis

The results of the Chi-Square Tests across different region lengths is shown below.

```{r, echo=FALSE, fig.width=7, fid.height=3}

# Define region lengths to test
region_lengths <- c(500, 1000, 5000, 10000, 20000, 50000)

# Data frame to store analysis results
palindrome_cluster_results <- data.frame(
  `Region Length` = integer(),
  `Max Count` = numeric(),
  `Max Interval` = integer(),
  `Expected Count` = numeric(),
  `Chi-Square p-value` = numeric(),
  `Interpretation` = character()
)

# Function to analyze palindromic clusters and store results
analyze_palindromic_clusters <- function(region_length) {
  # Define the region breaks
  region_breaks <- seq(1, sequence_length, by = region_length)
  num_intervals <- length(region_breaks) - 1
  
  # Initialize counts vector for each interval
  counts_vector <- rep(0, num_intervals)
  
  # Count palindromes in each interval
  region_indices <- cut(hcmv_data$location, breaks = region_breaks, include.lowest = TRUE, labels = FALSE)
  counts <- table(region_indices)
  counts_vector[as.numeric(names(counts))] <- as.vector(counts)
  
  # Find the maximum palindrome count and its interval
  max_count <- max(counts_vector)
  max_interval <- which(counts_vector == max_count)
  
  # Expected count per interval under uniform distribution
  expected_count <- length(hcmv_data$location) / num_intervals
  
  # Chi-square test for uniform distribution
  chi_square_test <- chisq.test(counts_vector, p = rep(1 / num_intervals, num_intervals), simulate.p.value = TRUE)
  interpretation <- ifelse(chi_square_test$p.value < 0.001, 
                           "Significant", 
                           "Not Significant")

  # Append the results to the palindrome_cluster_results data frame
  palindrome_cluster_results <<- rbind(
    palindrome_cluster_results,
    data.frame(
      `Region Length` = region_length,
      `Max Count` = max_count,
      `Max Interval` = max_interval,
      `Expected Count` = expected_count,
      `Chi-Square p-value` = chi_square_test$p.value,
      `Interpretation` = interpretation
    )
  )
}

# Analyze for each region length and store results
results <- lapply(region_lengths, analyze_palindromic_clusters)

kable(palindrome_cluster_results, caption = "Chi-Square Test Results") %>%
  kable_styling(latex_options = c("striped", "hold_position"), full_width = FALSE)

```

### 2.4.3 Conclusion

As shown in the table above, only the smallest region length (500) showed a significant p-value, while the larger region lengths (1000, 5000, 10000, 20000, and 50000) did not. This suggests that clustering of palindromic sequences exists on a small scale but not over broader intervals. The presence of a high number of palindromic sequences within an interval suggests non-random clustering, which may signal biological importance. Since the statistical analysis shows that the count in this interval is significantly higher than expected by chance, this could imply functional relevance, such as a replication origin.

## 2.5 Recommendations for Biologists

Our statistical analysis can provide insight on how to start experimentally searching for the origin of replication. The results showed a significant clustering of palindromic sequences in small regions (length 500), while larger intervals showed a more uniform distribution. These findings suggest that the origin of replication may lie in one of these dense clusters of palindromic sequences within shorter segments of DNA. Given the statistically significant clustering at region length 500, biologists could begin the experimental search within these smaller regions.

For a more detailed explanation and further discussion on these findings, refer to the [Discussion](#discussion).

# 3. Advanced Analysis

## 3.1 Methods

The goal of this analysis is to evaluate the robustness of statistical assumptions used to analyze palindrome distribution across the CMV DNA sequence. Specifically, we examine how results from statistical tests—such as the Chi-square and Poisson tests—vary across different interval lengths. By assessing if observed palindrome counts align with expected values for each interval size, we aim to identify the most appropriate interval length for studying palindrome clustering and to determine if a uniform distribution model adequately describes palindrome distribution.

We will calculate palindrome counts within a range of interval lengths (100, 500, 1000, 5000, 10000). For each interval length, we apply Chi-square and Poisson tests to assess if observed palindrome counts match the expectations under a uniform random scatter assumption. A significant variation in test outcomes may suggest that the uniform scatter assumption is sensitive to interval length.

We begin with dividing the 229,354 bases into non-overlapping intervals of different lengths. For each chosen interval length, we calculate the observed number of palindromes within each interval across the DNA sequence. Based on a uniform distribution, the expected count per interval is calculated as:
   \[
   E_i = \frac{\text{Total Palindromes}}{\text{Total Intervals}}
   \]
   
   - **Chi-square Goodness-of-Fit Test**: For each interval size, we use the Chi-square test to compare observed vs. expected counts:
     \[
     \chi^2 = \sum_{i=1}^{n} \frac{(O_i - E_i)^2}{E_i}
     \]
     where \(O_i\) and \(E_i\) are the observed and expected counts for each interval \(i\).

   - **Poisson Distribution Test**: If the palindromic sites are randomly scattered across the DNA sequence, the counts in intervals should follow a Poisson distribution because a Poisson process models random events occurring at a constant rate over space. Assuming that palindrome locations follow a Poisson process, we calculate the probability of observed counts within each interval and test if they align with a Poisson distribution using a goodness-of-fit approach. A Poisson distribution is defined for count data where events occur independently, with a constant average rate \(\lambda\) over an interval. The probability of observing \( k \) palindromic sites in an interval is:
     \[
     P(X = k) = \frac{\lambda^k e^{-\lambda}}{k!}
     \]
For our analysis, \(\lambda\) is calculated as the **mean number of palindromes per interval**: \(\lambda = \frac{\text{total palindromes}}{\text{number of intervals}}\). This assumption is justified because each interval is of equal length, so we expect a constant rate if the sites are randomly scattered.
     
If **p-value > \(\alpha\) ** (e.g., \(\alpha\) = 0.05), we *fail to reject* the null hypothesis, suggesting that the observed palindrome counts align with a Poisson distribution. This alignment supports the assumption of random scattering in the data.

If **p-value \(\leq\) \(\alpha\)**, we *reject* the null hypothesis, indicating that palindrome counts likely deviate from a Poisson distribution, suggesting clustering or non-random scatter.

## 3.2 Analysis

Histograms of palindrome counts for each interval length are as follows:

```{r, echo=FALSE, fig.height=4}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

interval_sizes <- c(500, 1000, 5000, 10000)

# Chi-square and Poisson test functions
perform_chisq_test <- function(observed_counts, expected_counts) {
  chisq_test <- chisq.test(observed_counts, p = expected_counts / sum(expected_counts), simulate.p.value = TRUE)
  return(chisq_test$p.value)
}

p_values_chi <- numeric(length(interval_sizes))
p_values_poisson <- numeric(length(interval_sizes))
results_summary <- data.frame()

# Loop over different interval sizes
for (interval_size in interval_sizes) {
  
  # Real data: group counts by interval
  real_counts <- table(cut(hcmv$location, 
                           breaks = seq(from = 1, to = sequence_length, by = interval_size), 
                           include.lowest = TRUE))

  # Simulated data: group counts by interval
  simulated_counts <- table(cut(simulated_palindromes, 
                                breaks = seq(1, sequence_length, by = interval_size), 
                                include.lowest = TRUE))
  
  
  # Chi-square test on real vs expected under uniform distribution
  expected_count <- rep(num_palindromes * interval_size / sequence_length, length(real_counts))
  chi_p_value <- perform_chisq_test(as.vector(real_counts), expected_count)
  
  # Poisson test (mean assumed as expected count - Poisson)
  observed_counts <- as.numeric(real_counts)
  lambda <- mean(observed_counts)
  poisson_p_value <- poisson.test(sum(observed_counts), T = length(real_counts), r = lambda)$p.value
  
  # results
  results_summary <- rbind(results_summary, 
                           data.frame(interval_size = interval_size,
                                      mean_real_counts = mean(observed_counts),
                                      mean_sim_counts = mean(simulated_counts),
                                      var_real_counts = var(observed_counts),
                                      var_sim_counts = var(simulated_counts),
                                      chi_p_value = chi_p_value,
                                      expected_count = expected_count[1],
                                      poisson_p_value = poisson_p_value))
  
  # Histogram plot for counts
  sim_density <- density(simulated_counts)
  obs_density <- density(observed_counts)
  y_max <- max(sim_density$y, obs_density$y) * 2
  x_max <- max(sim_density$x, obs_density$x) * 1.1
  
  if (interval_size == 500) {
    hist(simulated_counts, 
         breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), 
         probability = TRUE, 
         col = rgb(0, 0, 1, 0.25),
         ylim = c(0, 0.6),
         main = paste("Counts Distribution for Interval Size:", interval_size),
         xlab = "Counts per Interval",
         xlim = c(-1,x_max))
    hist(observed_counts, breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), col = rgb(1, 0, 0, 0.25), probability = TRUE, add = TRUE)
  } else if (interval_size == 1000) {
  # Plot the histograms with the same y-axis limit
    hist(simulated_counts, ylim = c(0,0.4), breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), probability = TRUE, col = rgb(0, 0, 1, 0.25), main = paste("Counts Distribution for Interval Size:", interval_size),
         xlab = "Counts per Interval")
    hist(counts, breaks = c(-1, 0, 1, 2, 3, 4, 5, 6, 7, 8), probability = TRUE, col = rgb(1, 0, 0, 0.25), add = TRUE)
  } else if (interval_size == 5000) {
    hist(simulated_counts, 
         probability = TRUE, 
         col = rgb(0, 0, 1, 0.25),
         breaks = 5,
         main = paste("Counts Distribution for Interval Size:", interval_size),
         xlab = "Counts per Interval",
         xlim = c(-1,20))
    hist(observed_counts, breaks = 10, col = rgb(1, 0, 0, 0.25), probability = TRUE, add = TRUE)
  } else {
    hist(simulated_counts, 
         probability = TRUE, 
         col = rgb(0, 0, 1, 0.25),
         ylim = c(0, 0.2),
         breaks = 5,
         main = paste("Counts Distribution for Interval Size:", interval_size),
         xlab = "Counts per Interval",
         xlim = c(0,25))
    hist(observed_counts, breaks = 8, col = rgb(1, 0, 0, 0.25), probability = TRUE, add = TRUE)
    
  }
  abline(v = expected_count[1], col = "red", lwd = 1, lty = 2)
  legend("topright", legend = c("Real Data", "Simulated Data"),
         fill = c(rgb(1, 0, 0, 0.25), rgb(0, 0, 1, 0.25)), border = NA)
}
par(mfrow = c(1, 1), cex = 1)
```

The summary provided displays results from simulations at four different interval sizes (500, 1000, 5000, and 10,000 base pairs) to test the assumption of a Poisson distribution for palindrome counts across these intervals:
```{r, echo=FALSE}
# Load necessary libraries
library(knitr)
library(kableExtra)

# Create data frame for results summary
results_summary <- data.frame(
  "Interval" = c(500, 1000, 5000, 10000),
  "Real Mean" = c(0.646, 1.293, 6.423, 12.727),
  "Sim Mean" = c(0.646, 1.293, 6.489, 12.955),
  "Real Var" = c(0.894, 1.646, 9.749, 14.589),
  "Sim Var" = c(0.623, 1.146, 6.028, 10.807),
  "Chi-Square" = c(0.0005, 0.0055, 0.0175, 0.2939),
  "Expected Count" = c(0.6453, 1.2906, 6.4529, 12.9058),
  "Poisson" = c(1, 1, 1, 1)
)

# Generate table with kable
kable(results_summary, caption = "Count Summary for Various Interval Sizes") %>%
  kable_styling(latex_options = c("striped", "hold_position"), full_width = FALSE)
```

`mean_real_counts` and `mean_sim_counts` show the average number of palindromic sites per interval for real data and randomly scattered data, respectively. These values should be similar if the observed data matches the randomness of the simulation. 

`var_real_counts` and `var_sim_counts` reflect the variance in the count of palindromic sites per interval for both real and simulated data. In a true Poisson distribution, we expect the mean and variance to be roughly equal, especially in larger intervals where random scatter is more evident.

`chi_p_value` assesses how well the observed distribution of palindromic counts aligns with the simulated distribution under the Chi-square test. A low p-value (e.g., <0.05) suggests a statistically significant difference, indicating that the real data distribution may deviate from the expected Poisson scatter.

`poisson_p_value` shows results from a goodness-of-fit test specifically for the Poisson distribution.

## 3.3 Conclusion

The results indicated that, as interval size increased, the fit between real and simulated data generally improved, as evidenced by increasing Chi-square p-values. For smaller intervals (500 and 1000 base pairs), the Chi-square p-values were below the 0.05 significance threshold, suggesting a significant deviation from randomness; this implies clustering at finer scales or patterns not accounted for by a uniform model, indicating that palindromic sites are more densely distributed in certain areas than would be expected under a random scatter model. As interval sizes increased to 5000 and 10,000 base pairs, the Chi-square p-values become larger (e.g., 0.29 at 10,000 base pairs), indicating that the real data more closely aligns with the simulated data, as would be expected under random scatter over larger scales.

The Poisson p-values remained high across all interval sizes, suggesting that, on average, palindrome counts align with a Poisson distribution. This supports the random scattering assumption when considering large-scale patterns across the DNA sequence, even if there are minor local deviations at smaller scales.

This implies that palindrome distribution in the DNA sequence may show clustering at smaller scales, yet appears more random when observed over larger intervals. Smaller intervals provide finer granularity, while larger intervals aggregate more data, which might smooth out fluctuations. Although the Poisson distribution offers a useful general model for palindromic distribution in the CMV DNA sequence, clustering patterns become apparent at finer scales, questioning the assumption of a purely uniform scatter. This may inform researchers on the appropriate interval size for studying palindrome distribution, as smaller intervals could reveal structural patterns, while larger intervals support the assumption of uniform random scatter.

# 4. Discussion {#discussion}

The primary goal of this analysis was to investigate whether the distribution of palindromes in the CMV DNA sequence deviates from a uniform scatter or if any clusters are due to random chance, comparing the actual palindrome distribution to simulated random scatterings. We examined the spacing and counts of palindromic sequences across DNA intervals, looking for potential clusters that might indicate functional regions like replication origins. To do this, we simulated random palindrome locations, compared them to the real data, and used Chi-square and Poisson tests to assess how well the observed distribution fit with the expected random pattern across different interval sizes.

Our findings showed that, overall, the distribution of palindromic sequences in the CMV genome closely resembled a random scatter, with no large-scale clusters that might suggest specific functional regions. The Kolmogorov-Smirnov tests, comparing real data to random simulations, produced high p-values, indicating no significant deviations from randomness. However, when we looked at smaller intervals (like 500 base pairs), we found some significant clustering of palindromes. This was confirmed by Chi-square tests, which showed a notable difference in palindrome counts compared to the random model. These results suggest that, while the overall genome-wide distribution of palindromes appears random, there are localized clusters that could have functional significance, possibly related to replication origins or other regulatory elements.

Additionally, our analysis highlighted the importance of choosing the right interval size for statistical tests. Smaller intervals (like 500 or 1000 bases) revealed significant deviations from uniformity, suggesting potential clusters of palindromes, whereas larger intervals (e.g., 5000 or 10,000 bases) seemed to follow a more random distribution. This suggests that smaller intervals can uncover finer details of biological patterns, while larger ones smooth out small-scale fluctuations and make the data look more random. The significant clustering of palindromes in the 500-base pair intervals could provide clues for locating the origin of replication in CMV, as replication origins often show specific sequence patterns. These findings could guide future research on identifying replication origins or other important biological sites.

There are a few limitations to this analysis. Although we used a range of interval sizes, the choice of breaks was still somewhat arbitrary and might not reflect biologically meaningful regions within the sequence. Our analysis also assumes that palindromic sites are randomly distributed if they don’t serve a functional purpose. However, biological systems are often more organized than random distributions suggest, and factors we didn’t measure—like specific sequence motifs or binding sites—could impact where palindromes occur. Including more variables in future analyses could clarify these relationships and lead to a more accurate model for understanding palindromic site distributions.

# 5. Appendix {#appendix}

```{r, echo=FALSE, fig.height=3}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 2) + 0.1, cex = 0.7)

simulated_palindromes_repeated <- replicate(4, sort(sample(1:sequence_length, num_palindromes, replace = TRUE)))

# Plots a few random simulations for qualitative comparison
hist(simulated_palindromes_repeated[,1], breaks = 20, probability = TRUE,
     main = "Simulated Random Scatter of Palindromic Sites",
     xlab = "Location in DNA Sequence")
lines(density(simulated_palindromes_repeated[,1], adjust = 1))
hist(simulated_palindromes_repeated[,2], breaks = 20, probability = TRUE,
     main = "Simulated Random Scatter of Palindromic Sites",
     xlab = "Location in DNA Sequence")
lines(density(simulated_palindromes_repeated[,2], adjust = 1))
hist(simulated_palindromes_repeated[,3], breaks = 20, probability = TRUE,
     main = "Simulated Random Scatter of Palindromic Sites",
     xlab = "Location in DNA Sequence")
lines(density(simulated_palindromes_repeated[,3], adjust = 1))
hist(simulated_palindromes_repeated[,4], breaks = 20, probability = TRUE,
     main = "Simulated Random Scatter of Palindromic Sites",
     xlab = "Location in DNA Sequence")
lines(density(simulated_palindromes_repeated[,4], adjust = 1))
par(mfrow = c(1, 1), cex = 1)

```
